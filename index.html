<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIDIR - C-IED Compendium</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        unidirBlue: '#009edb', 
                        unidirDark: '#1a2b3c',
                        unidirLight: '#f4f7fa'
                    },
                    fontFamily: { sans: ['Helvetica Neue', 'Arial', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hide-section { display: none !important; }
        .nav-active { color: #009edb; border-bottom: 3px solid #009edb; }
        .modal-overlay { background-color: rgba(26, 43, 60, 0.9); backdrop-filter: blur(4px); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen font-sans">

    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 h-20 flex justify-between items-center">
            <div class="flex items-center gap-4 cursor-pointer hover:opacity-80 transition" onclick="showSection('home')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/a/a2/UNIDIR-dual-emblem-name-only-logo-blue-black.png" alt="UNIDIR Logo" class="h-12 md:h-14 w-auto">
                <div class="hidden md:flex flex-col border-l-2 border-gray-300 pl-4 justify-center h-10">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">C-IED KNOWLEDGE HUB</span>
                    <span class="text-lg font-bold text-unidirDark leading-none">Online Compendium</span>
                </div>
            </div>
            <nav class="hidden lg:flex space-x-8 text-sm font-bold text-gray-600 uppercase tracking-wide h-full items-center">
                <button onclick="showSection('home')" id="nav-home" class="h-full border-b-4 border-transparent hover:text-unidirBlue transition nav-active">Home</button>
                <button onclick="showSection('db')" id="nav-db" class="h-full border-b-4 border-transparent hover:text-unidirBlue transition">Database</button>
                <button onclick="showSection('contribute')" id="nav-contribute" class="h-full border-b-4 border-transparent hover:text-unidirBlue transition">Contribute</button>
            </nav>
            <div class="flex items-center gap-3">
                <a href="https://unidir.org" target="_blank" class="text-xs font-bold text-gray-400 hover:text-unidirBlue transition">UNIDIR.ORG <i class="ph-bold ph-arrow-square-out"></i></a>
            </div>
        </div>
    </header>

    <main class="flex-grow relative">

        <section id="sect-home" class="fade-in">
            <div class="bg-unidirDark text-white py-24 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-5 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                <div class="container mx-auto px-4 text-center max-w-4xl relative z-10">
                    <div class="inline-block bg-blue-500/20 border border-blue-400/30 rounded-full px-4 py-1 mb-6 backdrop-blur-sm">
                        <p class="text-blue-200 text-xs font-bold uppercase tracking-widest">Mandated by UNGA Resolution A/RES/79/53</p>
                    </div>
                    <h1 class="text-4xl md:text-6xl font-bold mb-8 leading-tight">Countering the Threats posed by IEDs<br> through Shared Knowledge</h1>
                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                        <button onclick="showSection('db')" class="bg-unidirBlue text-white font-bold px-8 py-4 rounded shadow-lg hover:bg-blue-600 transition flex items-center justify-center gap-2 transform hover:-translate-y-1">
                            <i class="ph-bold ph-magnifying-glass text-xl"></i> Explore Database
                        </button>
                        <button onclick="showSection('contribute')" class="bg-transparent border-2 border-gray-500 text-gray-300 font-bold px-8 py-4 rounded hover:bg-white hover:text-unidirDark transition flex items-center justify-center gap-2">
                            <i class="ph-bold ph-plus-circle text-xl"></i> Submit Measure
                        </button>
                    </div>
                </div>
            </div>
            <div class="bg-white border-b border-gray-200 py-12">
                <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div><div class="text-4xl font-bold text-unidirBlue mb-1">18+</div><div class="text-xs text-gray-500 font-bold uppercase tracking-widest">States Engaged</div></div>
                    
                    <a href="https://unidir.org/publication/counter-ied-capability-maturity-model-and-self-assessment-tool/" target="_blank" class="group block md:border-l md:border-r border-gray-100 hover:bg-gray-50 transition cursor-pointer p-2 rounded">
                        <div class="text-4xl font-bold text-unidirBlue mb-1 group-hover:underline">CMM/SAT</div>
                        <div class="text-xs text-gray-500 font-bold uppercase tracking-widest flex items-center justify-center gap-1">
                            Methodology <i class="ph-bold ph-arrow-square-out"></i>
                        </div>
                    </a>

                    <div><div class="text-4xl font-bold text-unidirBlue mb-1">Global</div><div class="text-xs text-gray-500 font-bold uppercase tracking-widest">Coverage</div></div>
                </div>
            </div>
        </section>

        <section id="sect-db" class="hide-section fade-in container mx-auto px-4 py-12 flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 sticky top-24">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-unidirDark flex items-center gap-2"><i class="ph-fill ph-faders"></i> Filters</h3>
                        <button onclick="resetFilters()" class="text-xs text-unidirBlue hover:underline">Reset All</button>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Keywords</label>
                            <input type="text" id="filter-search" onkeyup="renderGrid()" class="w-full bg-gray-50 border border-gray-200 rounded p-3 text-sm focus:border-unidirBlue focus:ring-1 focus:ring-unidirBlue outline-none transition" placeholder="Search title, country...">
                        </div>
                        
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Category</label>
                            <div class="flex flex-col gap-2">
                                <label class="flex items-center gap-2 cursor-pointer hover:text-unidirBlue select-none">
                                    <input type="checkbox" id="chk-up" onchange="renderGrid()" class="accent-unidirBlue w-4 h-4" checked> <span class="text-sm font-medium">Upstream</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-orange-500 select-none">
                                    <input type="checkbox" id="chk-down" onchange="renderGrid()" class="accent-orange-500 w-4 h-4" checked> <span class="text-sm font-medium">Downstream</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer hover:text-purple-600 select-none">
                                    <input type="checkbox" id="chk-cross" onchange="renderGrid()" class="accent-purple-600 w-4 h-4" checked> <span class="text-sm font-medium">Cross-cutting</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Component</label>
                            <select id="sel-component" onchange="renderGrid()" class="w-full bg-gray-50 border border-gray-200 rounded text-sm border p-3 outline-none cursor-pointer hover:bg-white transition">
                                <option value="all">All Components</option>
                                <option value="Assessment of capabilities and threats">Assessment of capabilities and threats</option>
                                <option value="Advocacy, policy, legislation and regulations">Advocacy, policy, legislation and regulations</option>
                                <option value="Security and control of explosives">Security and control of explosives</option>
                                <option value="Education on improvised explosive device risk">Education on IED risk</option>
                                <option value="Development of capabilities to counter improvised explosive devices">Development of capabilities to counter IEDs</option>
                                <option value="Border controls">Border controls</option>
                                <option value="Control of precursors">Control of precursors</option>
                                <option value="Regional and international cooperation and information-sharing">Regional and international cooperation</option>
                                <option value="Intelligence-led operations">Intelligence-led operations</option>
                                <option value="IED response: render safe">IED response: render safe</option>
                                <option value="IED response: scene exploitation">IED response: scene exploitation</option>
                                <option value="Recovered evidence analysis">Recovered evidence analysis</option>
                                <option value="Information management">Information management</option>
                                <option value="Technical exploitation of recovered devices">Technical exploitation of recovered devices</option>
                                <option value="Identification of perpetrators">Identification of perpetrators</option>
                                <option value="Victim assistance">Victim assistance</option>
                                <option value="Judicial process">Judicial process</option>
                                <option value="Development of countermeasures">Development of countermeasures</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Maturity Level</label>
                            <select id="sel-maturity" onchange="renderGrid()" class="w-full bg-gray-50 border border-gray-200 rounded text-sm border p-3 outline-none cursor-pointer hover:bg-white transition">
                                <option value="all">All Levels</option>
                                <option value="Level 1 to 2">Level 1 to 2</option>
                                <option value="Level 2 to 3">Level 2 to 3</option>
                                <option value="Level 3 to 4">Level 3 to 4</option>
                                <option value="Level 4 to 5">Level 4 to 5</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Context</label>
                            <select id="sel-context" onchange="renderGrid()" class="w-full bg-gray-50 border border-gray-200 rounded text-sm border p-3 outline-none cursor-pointer hover:bg-white transition">
                                <option value="all">All Contexts</option>
                                <option value="National">National</option>
                                <option value="Regional">Regional</option>
                                <option value="Multilateral">Multilateral</option>
                            </select>
                        </div>
                    </div>
                </div>
            </aside>
            <div class="w-full lg:w-3/4">
                <div class="flex justify-between items-end mb-6 border-b border-gray-100 pb-4">
                    <h2 class="text-2xl font-bold text-unidirDark">Validated Measures</h2>
                    <span class="text-sm text-gray-500"><strong id="count-display" class="text-black">0</strong> measures found</span>
                </div>
                <div id="loader" class="hidden text-center py-10">
                    <div class="inline-block w-8 h-8 border-4 border-gray-200 border-t-unidirBlue rounded-full animate-spin"></div>
                    <p class="text-xs text-gray-400 mt-2">Connecting to database...</p>
                </div>
                <div id="grid-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                <div id="empty-state" class="hidden bg-gray-50 rounded border border-gray-200 p-12 text-center">
                    <i class="ph-duotone ph-magnifying-glass text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500 font-medium">No measures found matching your filters.</p>
                    <button onclick="resetFilters()" class="mt-4 text-unidirBlue text-sm font-bold hover:underline">Clear all filters</button>
                </div>
            </div>
        </section>

        <section id="sect-contribute" class="hide-section fade-in container mx-auto px-4 py-16 max-w-3xl">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-unidirDark mb-4">Submit National Measure(s)</h2>
                <p class="text-gray-600 max-w-xl mx-auto">Contribution to the Compendium is voluntary. Sharing your effective practices helps other Member States improve their C-IED capabilities.</p>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-lg border border-gray-200">
                <div class="flex items-start gap-4 mb-8">
                    <div class="bg-blue-50 p-3 rounded-full text-unidirBlue"><i class="ph-fill ph-envelope-simple text-2xl"></i></div>
                    <div>
                        <h4 class="font-bold text-lg">Submission via Email</h4>
                        <p class="text-sm text-gray-600 mt-1">Please download the template and send it to the project team.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <a href="./template.docx" download class="border border-gray-300 rounded p-4 flex items-center gap-3 hover:bg-gray-50 hover:border-unidirBlue transition text-left group">
                        <i class="ph-fill ph-file-doc text-2xl text-gray-400 group-hover:text-unidirBlue"></i>
                        <div><span class="block font-bold text-sm text-gray-700">Download Template</span><span class="text-xs text-gray-500">Word Document (.docx)</span></div>
                    </a>
                    <a href="mailto:cap-unidir@un.org" class="border border-gray-300 rounded p-4 flex items-center gap-3 hover:bg-gray-50 hover:border-green-500 transition text-left group">
                        <i class="ph-fill ph-paper-plane-right text-2xl text-gray-400 group-hover:text-green-600"></i>
                        <div><span class="block font-bold text-sm text-gray-700">Send via Email</span><span class="text-xs text-gray-500">cap-unidir@un.org</span></div>
                    </a>
                </div>
            </div>
        </section>

        <section id="sect-privacy" class="hide-section fade-in container mx-auto px-4 py-16 max-w-4xl">
            <h2 class="text-3xl font-bold text-unidirDark mb-6">Privacy Policy</h2>
            <div class="prose max-w-none text-gray-600">
                <p class="mb-4">This Compendium collects data voluntarily submitted by Member States. UNIDIR respects the privacy of all contributors and users.</p>
                <p class="mb-4"><strong>Data Collection:</strong> We do not collect personal data from users browsing this platform. Contact information submitted via the contribution process is used solely for verification purposes.</p>
                <p>For more details, please refer to the main <a href="https://unidir.org" target="_blank" class="text-unidirBlue underline">UNIDIR website</a> privacy policy.</p>
            </div>
        </section>

        <section id="sect-terms" class="hide-section fade-in container mx-auto px-4 py-16 max-w-4xl">
            <h2 class="text-3xl font-bold text-unidirDark mb-6">Terms of Use</h2>
            <div class="prose max-w-none text-gray-600">
                <p class="mb-4"><strong>Disclaimer:</strong> The content of this Compendium is for information purposes only. The views expressed do not necessarily reflect the views of UNIDIR or the United Nations.</p>
                <p class="mb-4"><strong>Usage:</strong> The practices listed herein are provided "as is". Member States are encouraged to adapt them to their specific national contexts.</p>
            </div>
        </section>

        <section id="sect-methodology" class="hide-section fade-in container mx-auto px-4 py-16 max-w-4xl">
            <h2 class="text-3xl font-bold text-unidirDark mb-6">Compendium Methodology</h2>
            <div class="prose max-w-none text-gray-600 space-y-4">
                <p>This Compendium is built upon the UNIDIR Counter-IED Capability Maturity Model and Self-Assessment Tool (CMM/SAT).</p>
                <h3 class="text-xl font-bold text-unidirDark">Data Collection</h3>
                <p>Data is collected through voluntary submissions from Member States, regional consultations, and validated open-source reports.</p>
                <h3 class="text-xl font-bold text-unidirDark">Validation Process</h3>
                <p>All submitted measures undergo a technical review by UNIDIR experts to ensure they align with the CMM/SAT framework and represent effective practices before being published.</p>
                <h3 class="text-xl font-bold text-unidirDark">Categorization</h3>
                <ul class="list-disc pl-5">
                    <li><strong>Upstream:</strong> Measures focusing on prevention, regulation, and intelligence.</li>
                    <li><strong>Downstream:</strong> Measures focusing on response, investigation, and disposal.</li>
                    <li><strong>Cross-cutting:</strong> Measures that apply across the spectrum (e.g., Information Management, Cooperation).</li>
                </ul>
            </div>
        </section>

    </main>

    <footer class="bg-unidirDark text-white py-8 mt-auto">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4 opacity-70 hover:opacity-100 transition">
            <div class="flex items-center gap-3">
                <img src="https://upload.wikimedia.org/wikipedia/commons/a/a2/UNIDIR-dual-emblem-name-only-logo-blue-black.png" class="h-8 brightness-0 invert p-0.5">
                <span class="text-xs">&copy; 2025 UNIDIR. All rights reserved.</span>
            </div>
            <div class="text-xs font-bold flex gap-4">
                <button onclick="showSection('privacy')" class="hover:text-white hover:underline">Privacy Policy</button>
                <button onclick="showSection('terms')" class="hover:text-white hover:underline">Terms of Use</button>
                <button onclick="showSection('methodology')" class="hover:text-white hover:underline">Methodology</button>
            </div>
        </div>
    </footer>

    <div id="modal-detail" class="fixed inset-0 modal-overlay z-[60] hidden flex items-center justify-center px-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col animate-[fadeIn_0.3s_ease-out] overflow-hidden">
            <div id="modal-bar" class="h-3 w-full bg-gray-200"></div>
            <div class="p-8 overflow-y-auto custom-scrollbar">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex flex-wrap gap-2">
                        <span id="m-cat" class="text-[10px] font-bold px-2 py-1 rounded uppercase bg-gray-100 text-gray-600">CATEGORY</span>
                        <span id="m-context" class="text-[10px] font-bold px-2 py-1 rounded border border-gray-300 text-gray-500">CONTEXT</span>
                    </div>
                    <button onclick="toggleModal('modal-detail')" class="text-gray-400 hover:text-red-500 transition p-1"><i class="ph-bold ph-x text-xl"></i></button>
                </div>
                <h2 id="m-title" class="text-2xl font-bold text-unidirDark mb-2 leading-tight mt-2">Title Placeholder</h2>
                <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500 font-bold mb-6 pb-6 border-b border-gray-100">
                    <span class="flex items-center gap-1 text-unidirBlue"><i class="ph-fill ph-map-pin"></i> <span id="m-country">Country</span></span>
                    <span class="hidden md:inline text-gray-300">|</span>
                    <span class="flex items-center gap-1"><i class="ph-bold ph-calendar-blank"></i> <span id="m-year">2024</span></span>
                    <span class="hidden md:inline text-gray-300">|</span>
                    <span class="flex items-center gap-1"><i class="ph-fill ph-squares-four"></i> <span id="m-comp">Component</span></span>
                </div>
                <div class="mb-6">
                    <span class="text-xs font-bold text-gray-400 uppercase mb-1 block">Maturity Transition</span>
                    <div class="inline-flex items-center gap-2 bg-gray-50 border border-gray-200 px-3 py-1.5 rounded-lg text-sm font-bold text-gray-700">
                        <i class="ph-fill ph-trend-up text-green-500"></i>
                        <span id="m-maturity">Level X to Y</span>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Description</h4>
                        <div id="m-desc" class="text-gray-800 leading-relaxed text-base space-y-3"></div>
                    </div>
                    <div class="bg-blue-50 p-5 rounded-lg border border-blue-100 relative">
                        <div class="absolute top-4 right-4 text-blue-200"><i class="ph-fill ph-target text-2xl"></i></div>
                        <h4 class="text-xs font-bold text-blue-600 uppercase mb-2">Impact & Outcome</h4>
                        <p id="m-impact" class="text-sm text-blue-900 leading-relaxed italic">...</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 p-4 border-t border-gray-200 text-right">
                <button onclick="toggleModal('modal-detail')" class="px-6 py-2 bg-white border border-gray-300 rounded text-sm font-bold text-gray-600 hover:bg-gray-100 transition shadow-sm">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const SPECIFIC_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQZxkDfAI9kkFd1zJ5qzf5CsvnFPqwlr3Wkxvb3RxadTf_TtpddP9A6X4ip_STdUVxsmza75xCkYeqo/pub?gid=0&single=true&output=csv";

        let database = [];

        window.onload = function() { loadData(); };

        function loadData() {
            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');

            Papa.parse(SPECIFIC_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // ID for details modal
                    database = results.data.map((item, i) => ({ ...item, id: i }));
                    loader.classList.add('hidden');
                    renderGrid();
                },
                error: function(err) {
                    console.error("Error loading CSV:", err);
                    alert("Error loading database. Check Google Sheet published status.");
                    loader.classList.add('hidden');
                }
            });
        }

        function showSection(sectName) {
            // Hide all sections
            const sections = ['home', 'db', 'contribute', 'privacy', 'terms', 'methodology'];
            sections.forEach(s => {
                const el = document.getElementById('sect-' + s);
                if(el) el.classList.add('hide-section');
                
                // Nav active state (only for top nav items)
                const nav = document.getElementById('nav-' + s);
                if(nav) nav.classList.remove('nav-active');
            });

            // Show target
            document.getElementById('sect-' + sectName).classList.remove('hide-section');
            
            // Set active nav if exists
            const activeNav = document.getElementById('nav-' + sectName);
            if(activeNav) activeNav.classList.add('nav-active');
            
            window.scrollTo(0,0);
        }

        function toggleModal(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
            document.body.style.overflow = el.classList.contains('hidden') ? 'auto' : 'hidden';
        }

        // ==========================================
        // RENDER & FILTERS
        // ==========================================
        function renderGrid() {
            const grid = document.getElementById('grid-container');
            grid.innerHTML = "";

            const search = document.getElementById('filter-search').value.toLowerCase();
            
            // Category Checks
            const showUp = document.getElementById('chk-up').checked;
            const showDown = document.getElementById('chk-down').checked;
            const showCross = document.getElementById('chk-cross').checked;
            
            const fComp = document.getElementById('sel-component').value;
            const fMat = document.getElementById('sel-maturity').value;
            const fCtx = document.getElementById('sel-context').value;

            let count = 0;

            database.forEach(item => {
                let isValid = true;
                if(item.Validated) {
                    const val = item.Validated.trim().toUpperCase();
                    if(val !== "TRUE" && val !== "YES" && val !== "VRAI") isValid = false;
                }
                
                if(!item.Title || !isValid) return;

                const txt = (item.Title + " " + item.Country + " " + item.Description).toLowerCase();
                const matchSearch = txt.includes(search);
                
                // Match Category (Loose matching for Cross-cutting)
                const cat = (item.Category || "").trim();
                let matchCat = false;
                
                if (cat === 'Upstream' && showUp) matchCat = true;
                else if (cat === 'Downstream' && showDown) matchCat = true;
                else if (cat.toLowerCase().includes('cross') && showCross) matchCat = true;

                const matchComp = (fComp === 'all') || (item.Component === fComp);
                const matchMat = (fMat === 'all') || (item.Maturity === fMat);
                const matchCtx = (fCtx === 'all') || (item.Context && item.Context.includes(fCtx));

                if(matchSearch && matchCat && matchComp && matchMat && matchCtx) {
                    count++;
                    createCard(item, grid);
                }
            });

            document.getElementById('count-display').innerText = count;
            if(count === 0) document.getElementById('empty-state').classList.remove('hidden');
            else document.getElementById('empty-state').classList.add('hidden');
        }

        function createCard(item, container) {
            // Determine Color Scheme based on Category
            const cat = (item.Category || "").trim();
            let colorLine = 'bg-gray-500';
            let badgeClass = 'bg-gray-100 text-gray-700 border-gray-100';

            if(cat === 'Upstream') {
                colorLine = 'bg-unidirBlue';
                badgeClass = 'bg-blue-50 text-blue-700 border-blue-100';
            } else if (cat === 'Downstream') {
                colorLine = 'bg-orange-500';
                badgeClass = 'bg-orange-50 text-orange-700 border-orange-100';
            } else if (cat.toLowerCase().includes('cross')) {
                colorLine = 'bg-purple-600';
                badgeClass = 'bg-purple-50 text-purple-700 border-purple-100';
            }

            const location = item.Country || item.Region || "Global";

            const card = document.createElement('div');
            card.className = "cursor-pointer bg-white rounded-lg shadow-sm hover:shadow-lg hover:-translate-y-1 transition border border-gray-200 p-6 relative overflow-hidden group flex flex-col h-full";
            card.onclick = () => openDetail(item.id);

            card.innerHTML = `
                <div class="absolute top-0 left-0 w-1.5 h-full ${colorLine}"></div>
                <div class="flex justify-between items-start mb-3 pl-2">
                    <span class="${badgeClass} border text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">${item.Category || 'N/A'}</span>
                    <span class="text-[10px] font-bold text-gray-400 border border-gray-200 px-2 py-1 rounded uppercase">${item.Maturity || 'N/A'}</span>
                </div>
                <h4 class="text-lg font-bold text-unidirDark mb-2 pl-2 leading-snug group-hover:text-unidirBlue transition">${item.Title}</h4>
                <div class="flex items-center gap-2 text-xs font-bold text-gray-500 pl-2 mb-4">
                    <span class="flex items-center gap-1"><i class="ph-fill ph-map-pin text-unidirBlue"></i> ${location}</span>
                    <span class="text-gray-300">|</span>
                    <span class="text-gray-400">${item.Year || ''}</span>
                </div>
                <p class="text-sm text-gray-600 mb-6 pl-2 flex-grow leading-relaxed line-clamp-3">${item.Description || ''}</p>
                <div class="border-t border-gray-100 pt-4 mt-auto pl-2 flex justify-between items-center">
                    <span class="text-xs font-semibold text-gray-400 flex items-center gap-1">
                        <i class="ph-fill ph-squares-four"></i> ${item.Component ? item.Component.substring(0, 25) + (item.Component.length>25 ? '...' : '') : ''}
                    </span>
                    <i class="ph-bold ph-arrow-right text-unidirBlue opacity-0 group-hover:opacity-100 transition transform group-hover:translate-x-1"></i>
                </div>
            `;
            container.appendChild(card);
        }

        function openDetail(id) {
            const item = database.find(x => x.id === id);
            if(!item) return;

            document.getElementById('m-title').innerText = item.Title;
            document.getElementById('m-country').innerText = item.Country || item.Region || "Global";
            document.getElementById('m-year').innerText = item.Year || "";
            document.getElementById('m-comp').innerText = item.Component || "";
            document.getElementById('m-cat').innerText = item.Category || "";
            document.getElementById('m-context').innerText = item.Context || "";
            document.getElementById('m-maturity').innerText = item.Maturity || "";
            document.getElementById('m-impact').innerText = item.Impact || "No impact details.";

            // Format Description safely
            const desc = item.Description || "";
            const formattedDesc = desc.replace(/\n\n/g, '</p><p class="mt-3">').replace(/\n/g, '<br>');
            document.getElementById('m-desc').innerHTML = `<p>${formattedDesc}</p>`;

            // Colors
            const cat = (item.Category || "").trim();
            const bar = document.getElementById('modal-bar');
            const catBadge = document.getElementById('m-cat');
            
            if(cat === 'Upstream') {
                bar.className = "h-3 w-full bg-blue-500";
                catBadge.className = "text-[10px] font-bold px-2 py-1 rounded uppercase bg-blue-100 text-blue-700";
            } else if (cat === 'Downstream') {
                bar.className = "h-3 w-full bg-orange-500";
                catBadge.className = "text-[10px] font-bold px-2 py-1 rounded uppercase bg-orange-100 text-orange-700";
            } else if (cat.toLowerCase().includes('cross')) {
                bar.className = "h-3 w-full bg-purple-600";
                catBadge.className = "text-[10px] font-bold px-2 py-1 rounded uppercase bg-purple-100 text-purple-700";
            } else {
                bar.className = "h-3 w-full bg-gray-500";
                catBadge.className = "text-[10px] font-bold px-2 py-1 rounded uppercase bg-gray-100 text-gray-700";
            }

            toggleModal('modal-detail');
        }

        function resetFilters() {
            document.getElementById('filter-search').value = "";
            document.getElementById('chk-up').checked = true;
            document.getElementById('chk-down').checked = true;
            document.getElementById('chk-cross').checked = true;
            document.getElementById('sel-component').value = "all";
            document.getElementById('sel-maturity').value = "all";
            document.getElementById('sel-context').value = "all";
            renderGrid();
        }
    </script>
</body>
</html>
